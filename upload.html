<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./style/style.css" />
    <link rel="stylesheet" href="./style/style1.css" />
    <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
  />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
    rel="stylesheet"
  />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap"
    rel="stylesheet"
  />
    <title>upload</title>
</head>
<body>
    <nav>
        <div>Books</div>
        <div class="mid">
            <input type="text" placeholder="search for data">
        </div>
        <div>
            <a href="">home</a>
            <a href="">contact</a>
            <a href="">about</a>
        </div>
     </nav>

     <div class="main_up">
        <div>
            <h2>Upload csv File</h2>

            <label for="file1">   
                   <input type="file" name="" id="file1" accept="text/csv" class="hidden">
                 <div>
                Upload 
                <i class="fa-solid fa-upload"></i>
                 </div>
                </label>
           
        </div>
     </div>


<script>
  drawOptimized() {
        this.ctx?.clearRect(0, 0, this.canvasElement.width, this.canvasElement.height)
        let canvaWidth = this.canvasElement.offsetWidth
        let canvaHeight = this.canvasElement.offsetHeight
 
        let initHeight = 0
        let newScrollY = this.scrollY * this.cellheight / 100
        console.log("ðŸš€ ~ Excel ~ drawOptimized ~ newScrollY:", newScrollY)
        let newScrollX = this.scrollX
        this.ctx?.translate(-newScrollX, -newScrollY)
 
        for (let i = newScrollY / this.cellheight; i < this.data.length; i++) {
            const row = this.data[i];
            if (initHeight > canvaHeight + newScrollY) {
                break
            } else {
                let initWidth = 0
                initHeight += row[0].height
 
                // this.drawCell(row[0])
                for (let j = 0; j < row.length; j++) {
                    const col = row[j];
                    if (initWidth >= newScrollX && initWidth <= canvaWidth) {
                        this.drawCell(col)
                    }
                    if (initWidth > canvaWidth) break
                }
                // if (initHeight >= newScrollY && initHeight <= canvaHeight) {
                // }
                // if (initHeight > canvaHeight + newScrollY) break
            }
        }
        this.ctx?.setTransform(1, 0, 0, 1, 0, 0);
 
        // if (this.data.length && this.data[0].length) {
        //     if (!this.activeInputCell) {
        //         this.activeInputCell = this.data[0][0]
        //     }
        //     this.highLightCell(this.activeInputCell)
        // }
    }
</script>
     
</body>
</html>
this.leftctx.beginPath();
this.leftctx.save();
this.leftctx.fillStyle = "#E8E8E8";
this.leftctx.strokestyle = "black";
// console.log(data.data);
// this.ctx.fillRect(data.x, data.y,data.sizel,data.sizeb);  //arr[j]
this.leftctx.fillRect(
  alpha.xpos,
  alpha.ypos-this.scrollY,
  alpha.width,
  alpha.height
);
this.leftctx.strokeRect(
  alpha.xpos,
  alpha.ypos-this.scrollY,
  alpha.width,
  alpha.height
); //arr[j]
this.leftctx.fillStyle = "black";
this.leftctx.font = `${18}px areal`;
this.leftctx.fillText(
  alpha.data,
  alpha.xpos + 30,
  alpha.ypos + alpha.height - 5-this.scrollY
);
this.leftctx.stroke();
this.leftctx.restore()


marcing() {
  let totalwidth = 0;
  let totalheight = 0;
  for (let i = this.cellintial.col; i <= this.finalcell.col; i++) {
    totalwidth += this.arr2d[i][0].width;
  }
  console.log(totalwidth);
  for (let i = this.cellintial.row; i <= this.finalcell.row; i++) {
    totalheight += this.arr2d[i][0].height;
  }
  console.log(totalheight);
  this.datactx.save();
  this.datactx.beginPath();
  // Draw the rectangle
  this.datactx.rect(
    this.cellintial.xpos,
    this.cellintial.ypos,
    totalwidth,
    totalheight
  );
  this.datactx.lineWidth = 4;
  this.datactx.strokeStyle = "green";
  this.datactx.stroke();
  this.datactx.restore();
  requestAnimationFrame(() => this.marcing());
}
// border

border() {
  this.datactx.restore();
  this.datactx.beginPath();

  // Set a start-point
  this.datactx.strokeStyle = "green";
  // this.datactx.setLineDash([5, 5]); // Define the dash pattern
  // this.datactx.lineDashOffset = -this.offset;
  this.datactx.lineWidth = 2;
  this.datactx.moveTo(
    this.selectedfinal[0].xpos,
    this.selectedfinal[0].ypos - this.scrollY
  ); // start

  // Set an end-point

  this.datactx.lineTo(
    this.selectedfinal[0].xpos,
    this.selectedfinal[this.selectedfinal.length - 1].ypos -
      this.scrollY +
      this.selectedfinal[this.selectedfinal.length - 1].height
  ); // straight line first

  this.datactx.moveTo(
    this.selectedfinal[0].xpos,
    this.selectedfinal[0].ypos - this.scrollY
  );
  this.datactx.lineTo(
    this.selectedfinal[this.selectedfinal.length - 1].xpos +
      this.selectedfinal[this.selectedfinal.length - 1].width,
    this.selectedfinal[0].ypos - this.scrollY
  );

  this.datactx.moveTo(
    this.selectedfinal[this.selectedfinal.length - 1].xpos +
      this.selectedfinal[this.selectedfinal.length - 1].width,
    this.selectedfinal[0].ypos - this.scrollY
  );
  this.datactx.lineTo(
    this.selectedfinal[this.selectedfinal.length - 1].xpos +
      this.selectedfinal[this.selectedfinal.length - 1].width,
    this.selectedfinal[this.selectedfinal.length - 1].ypos -
      this.scrollY +
      this.selectedfinal[this.selectedfinal.length - 1].height
  );

  this.datactx.moveTo(
    this.selectedfinal[this.selectedfinal.length - 1].xpos +
      this.selectedfinal[this.selectedfinal.length - 1].width,
    this.selectedfinal[this.selectedfinal.length - 1].ypos -
      this.scrollY +
      this.selectedfinal[this.selectedfinal.length - 1].height
  );
  this.datactx.lineTo(
    this.selectedfinal[0].xpos,
    this.selectedfinal[this.selectedfinal.length - 1].ypos -
      this.scrollY +
      this.selectedfinal[this.selectedfinal.length - 1].height
  );

  // Draw it
  this.datactx.stroke();

  this.datactx.closePath();
}

// line draw

linedraw() {
  // console.log(this.selectedfinal.length)
  // console.log("thissss"+this.mini,this.maxi,this.minj,this.maxj )

  this.cellintial = this.arr2d[this.minj][this.mini];
  this.finalcell = this.arr2d[this.maxj][this.maxi];
  console.log(this.cellintial);
  console.log(this.finalcell);

  this.headersctx.beginPath();

  // Set a start-point
  this.headersctx.strokeStyle = "green";
  this.headersctx.lineWidth = 6;
  this.headersctx.moveTo(this.cellintial.xpos - this.scrollX, 30);

  // Set an end-point
  this.headersctx.lineTo(
    this.finalcell.xpos + this.finalcell.width - this.scrollX,
    30
  );

  // this.leftctx.moveTo(0, this.cellintial.ypos-this.scrollY);

  // // Set an end-point
  // this.leftctx.lineTo(0,this.finalcell.ypos+30 -this.scrollY);

  // Draw it
  this.headersctx.stroke();
  this.headersctx.restore();

  // this.leftctx.beginPath()
  // this.leftctx.strokeStyle = "green";
  // this.leftctx.lineWidth = 6;
  // this.leftctx.moveTo(50, this.cellintial.ypos-this.scrollY);

  // // Set an end-point
  // this.leftctx.lineTo(50,this.finalcell.ypos+30 -this.scrollY);

  // this.leftctx.stroke();
  // this.leftctx.restore();
}

//     // resize y 
//     resizey(e){
//       let rect1 = this.leftheaders.getBoundingClientRect()
//       let y = e.clientY - rect1.top + this.scrollY;
//       let sum = 0;
//       console.log(y)
// for(let i =0;i<this.sizeb.length;i++){
//   // console.log(sum)
//   if(sum + 2 > y && y > sum && y > 0){
//     console.log(sum)
//     this.leftheaders.style.cursor = "row-resize"
//     this.leftheaders.addEventListener("mousedown", (e) => this.redowny(e, this.leftheaders) );
//     break;
//         } else {
//           this.leftheaders.style.cursor = "default";
//         }
//   sum += this.sizeb[i]
// }
//     }


// redowny(e, leftheaders){
//   let addition =0;
//   let [x1, y1, total] = this.position(this.leftheaders, e); // calling for co-ordinates and total length from x position
//   this.prev_height1 = this.sizeb[y1 - 1];
// // moving tht cursor 
// let sumy = 0;

// for(let i =0;i<this.sizeb.length;i++){
//   if(y1>i){
//     sumy += this.sizeb[i]
//   }else{
//     break;
//   }
// }
// // console.log(sumy)

//   var resize_mousemove = (e) => {
//     let rect = leftheaders.getBoundingClientRect();
//     let y2 = e.clientY - rect.top + this.scrollY;
//     // console.log(total)
//     // console.log("total"+sumy)
//     // console.log(y1)
//     addition = y2 - sumy;
//     console.log("addi"+addition)
//   };
// // mouse up func will terminate
//   var resize_mouseup = (e) => {
//     if (this.prev_height1 + addition > 50) {
//       console.log(y1)
//       this.sizeb[y1 - 1] = Math.floor(this.prev_height1 + addition);

//       leftheaders.removeEventListener("mousemove", resize_mousemove);
//       console.log(this.sizeb)
//       // this.dynamicwidth(); // calling render and width func again
//       this.render();
//       leftheaders.removeEventListener("mouseup", resize_mouseup);
//     }
//   };
//   leftheaders.addEventListener("mousemove", resize_mousemove);
//   leftheaders.addEventListener("mouseup", resize_mouseup);
// }

// scrollelr
scrollerdiv(){
  // for y axis
    let scroldivy = document.createElement("div")
  scroldivy.classList.add("scroldiv")
  this.wraper.appendChild(scroldivy)
  let childscroll = document.createElement("div")
  childscroll.classList.add("childscroll")
  scroldivy.appendChild(childscroll)
  // console.log(this.arr2d.length)
  let divheight = this.arr2d.length * 30;
  childscroll.style.height=`${divheight}px`
  
  // for x axis
  let scroldivx = document.createElement("div")
  scroldivx.classList.add("scroldivx")
  this.wraper.appendChild(scroldivx)
  let childscrollx = document.createElement("div")
  childscrollx.classList.add("childscrollx")
  scroldivx.appendChild(childscrollx)
  // // console.log(this.arr2d.length)
  let divwidth = this.arr2d[0].length * 100;
  // console.log(divwidth)
  childscrollx.style.width=`${divwidth}px`
  
  
  let y = "y"
  scroldivy.addEventListener("scroll", (e) => this.scrollhandle(e,y));
  
  let x = "x"
  scroldivx.addEventListener("scroll",(e) => this.scrollhandle(e,x))
  
  
  }
  
  
  scrollhandle(e,axis){
  
  // console.log("scrolled")
  
  if(axis == 'y'){
  this.scrollY = Math.floor(e.target.scrollTop/30)*30;
  // this.render()
  }else{
    this.scrollX = Math.floor(e.target.scrollLeft/100)*100;
  //   this.render()
  }
  this.render()
  
  }



  // keydown func 
  /**
   * 
   * @param {Event} e keydown
   */
    // keyfunc(e) {
    //   if (this.acti != null) {
    //     this.datactx.clearRect( this.acti.xpos - this.scrollX,  this.acti.ypos - this.scrollY,  this.acti.width,  this.acti.height);
    //     this.datacell(this.acti);
    //     //made changes
    //     this.headersctx.clearRect(0, 0, this.headers.width, 30);
    //     this.headerdraw1();
    //     this.leftctx.clearRect(0, 0, 50, this.leftheaders.height);
    //     this.sidedraw1();
    //   }
    //   if(this.acti!=null){
    //   let { row, col } = this.acti;
    //   switch (e.keyCode) {
    //     case 37:
    //       if (col > 0) {
    //         this.acti = this.arr2d[row][col - 1];// left
    //         if (this.acti.xpos + this.acti.width - 200 < this.scrollX) {
    //           this.scrollX = Math.max(0, this.scrollX - 100);
    //           this.render();
    //         }
    //         this.line();
    //         this.selected(this.acti);
    //       }
    //       break;
    //     case 38:
    //       if (row > 1) {
    //         this.acti = this.arr2d[row - 1][col];// up
    //         if (this.acti.ypos + this.acti.height - 60 < this.scrollY) {
    //           this.scrollY = Math.max(0, this.scrollY - 30);
    //           this.render();
    //         }
    //         this.line();
    //         this.selected(this.acti);
    //       }
    //       break;
    //     case 39:
    //       this.acti = this.arr2d[row][col + 1]; // right
    //       if (this.acti.xpos + 100 > this.scrollX + this.data.width) {
    //         this.scrollX += 100;
    //         this.render();
    //       }
    //       this.line();
    //       this.selected(this.acti);
    //       break;
    //     case 40:
    //       this.acti = this.arr2d[row + 1][col]; // down
    //       if (this.acti.ypos + 60 > this.scrollY + this.data.height - 180) {
    //         this.scrollY += 30;
    //         this.render();
    //       }
    //       this.line();
    //       this.selected(this.acti);
    //       break;
    //     case 9://tab
    //       this.acti = this.arr2d[row][col + 1];
    //       if (this.acti.xpos + 100 > this.scrollX + this.data.width) {
    //         this.scrollX += 100;
    //         this.render();
    //       }
    //       this.selected(this.acti);
    //       break;
    //     case 13: // enter
    //       this.acti = this.arr2d[row + 1][col];
    //       if (this.acti.ypos + 60 > this.scrollY + this.data.height - 180) {
    //         this.scrollY += 30;
    //         this.render();
    //       }
    //       this.selected(this.acti);
    //       break;
    //     case 46: // delete
    //       // alert("delete")
    //       this.delete()
    //      break;
    //     case e.ctrlKey && 67: // COPY
    //     //  alert("COPY")
    //      this.copy()
    //     break;
    //     case e.ctrlKey && 86: // PASTE
    //     //  alert("PASTE")
    //      this.paste()
         
    //     break;
    //     case e.ctrlKey && 88: // CUT
    //     //  alert("CUT")
    //      this.cut()
    //     break;
    //     case 36:

    //      this.scrollX = 0; // Scroll to the far left
    //      this.scrollY = 0; // Scroll to the top
    //      this.render();
    //     break;
    //     default:
    //       break;
    //   }
    //   // this.render();
    
    // }
    
    // }
